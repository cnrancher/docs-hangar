"use strict";(self.webpackChunkdocs_hangar=self.webpackChunkdocs_hangar||[]).push([[7210],{1050:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>t,metadata:()=>c,toc:()=>o});var i=a(5893),r=a(1151);const t={title:"Scan image vulnerabilities"},s=void 0,c={id:"scan/scan",title:"Scan image vulnerabilities",description:"Hangar has built-in trivy\u2019s container image scanning function. You can use hangar scan command for scanning multi-platform container image vulnerabilities.",source:"@site/versioned_docs/version-v1.8/15-scan/01-scan.md",sourceDirName:"15-scan",slug:"/scan/scan",permalink:"/docs/v1.8/scan/scan",draft:!1,unlisted:!1,editUrl:"https://github.com/cnrancher/docs-hangar/edit/main/versioned_docs/version-v1.8/15-scan/01-scan.md",tags:[],version:"v1.8",lastUpdatedAt:1712484060,formattedLastUpdatedAt:"Apr 7, 2024",sidebarPosition:1,frontMatter:{title:"Scan image vulnerabilities"},sidebar:"docs",previous:{title:"Scan images",permalink:"/docs/v1.8/scan/"},next:{title:"Archive",permalink:"/docs/v1.8/archive/"}},l={},o=[{value:"Quick Start",id:"quick-start",level:2},{value:"Usage",id:"usage",level:2},{value:"Scan in Air-Gapped mode",id:"scan-in-air-gapped-mode",level:2},{value:"Scan in trivy client mode",id:"scan-in-trivy-client-mode",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Hangar has built-in ",(0,i.jsx)(n.a,{href:"https://aquasecurity.github.io/trivy/",children:"trivy"}),"\u2019s container image scanning function. You can use ",(0,i.jsx)(n.code,{children:"hangar scan"})," command for scanning multi-platform container image vulnerabilities."]}),"\n",(0,i.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsx)(n.p,{children:"Use following command to scan image vulnerabilities."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\nhangar scan \\\n    --file="example_image_list.txt" \\\n    --format="csv" \\\n    --arch="amd64,arm64" \\\n    --os="linux" \\\n    --jobs=4\n'})}),"\n",(0,i.jsxs)(n.p,{children:["By default, the scan report is in ",(0,i.jsx)(n.code,{children:"CSV"})," form format, you can customize the output ",(0,i.jsx)(n.code,{children:"--format"})," option to ",(0,i.jsx)(n.code,{children:"json"})," or ",(0,i.jsx)(n.code,{children:"yaml"})," format."]}),"\n",(0,i.jsxs)(n.p,{children:["If other errors occured when scan images (e.g. network connection timeout or manifest unknow), the scan failed images will output to ",(0,i.jsx)(n.code,{children:"scan-failed.txt"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-txt",metastring:'title="hangar scan --help"',children:'Scan container image vulnerabilities\n\nUsage:\n  hangar scan -f IMAGE_LIST.txt [flags]\n\nExamples:\n# Scan images by image list file and output CSV result.\nhangar scan \\\n        --file IMAGE_LIST.txt \\\n        --format csv \\\n        --arch amd64,arm64 \\\n        --os linux\n\nFlags:\n  -a, --arch strings                architecture list of images (default [amd64,arm64])\n  -y, --auto-yes                    answer yes automatically (used in shell script)\n      --cache string                trivy database cache directory (default "/home/starry-s/.cache/trivy")\n  -o, --failed string               file name of the scan failed image list (default "scan-failed.txt")\n  -f, --file string                 image list file\n      --format string               output report format (available: json/yaml/csv/spdx-json) (default "csv")\n  -h, --help                        help for scan\n  -j, --jobs int                    worker number, scan images parallelly (1-20) (default 1)\n      --offline-scan                scan in offline (air-gapped) mode\n      --os strings                  OS list of images (default [linux])\n      --project string              override all image projects in image list\n      --registry string             override all image registry URL in image list\n  -r, --report string               scan report output file (default "scan-report.[FORMAT]")\n      --scanner strings             list of scanners (available: vuln,misconfig,secret,license) (default [vuln])\n  -s, --server string               trivy server URL (scan as a trivy client mode)\n      --skip-db-update              skip updating trivy vulnerability database\n      --skip-java-db-update         skip updating trivy java index database\n      --timeout duration            timeout when mirror each images (default 10m0s)\n      --tls-verify                  require HTTPS and verify certificates (default true)\n      --trivy-db-repo string        trivy vulnerability database repository (default "ghcr.io/aquasecurity/trivy-db")\n      --trivy-java-db-repo string   trivy java database repository (default "ghcr.io/aquasecurity/trivy-java-db")\n      --trivy-log-output            show trivy log (only available in single worker mode)\n\nGlobal Flags:\n      --debug             enable debug output\n      --insecure-policy   run Hangar without policy check\n'})}),"\n",(0,i.jsx)(n.h2,{id:"scan-in-air-gapped-mode",children:"Scan in Air-Gapped mode"}),"\n",(0,i.jsx)(n.p,{children:"Follow these instructions to scan images in Air-Gapped environment."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.a,{href:"/docs/v1.8/mirror/mirror",children:"mirror"})," command to mirror trivy database images to private image registry, this step requires the network connection."]}),"\n",(0,i.jsxs)(n.p,{children:["Create a image list file to copy ",(0,i.jsx)(n.a,{href:"https://github.com/aquasecurity/trivy-db/pkgs/container/trivy-db",children:"trivy-db"})," and ",(0,i.jsx)(n.a,{href:"https://github.com/aquasecurity/trivy-java-db/pkgs/container/trivy-java-db",children:"trivy-java-db"})," images."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-txt",metastring:'title="database_images.txt"',children:"ghcr.io/aquasecurity/trivy-db:latest\nghcr.io/aquasecurity/trivy-java-db:1\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\nhangar mirror \\\n    --file="database_images.txt" \\\n    --destination="REGISTRY_SERVER_URL" \\\n    --jobs=2\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"scan"})," command with ",(0,i.jsx)(n.code,{children:"--offline-scan=true"})," and ",(0,i.jsx)(n.code,{children:"--trivy-db-repo"}),", ",(0,i.jsx)(n.code,{children:"--trivy-java-db-repo"})," options."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\nhangar scan \\\n    --file="example_image_list.txt" \\\n    --format="csv" \\\n    --arch="amd64,arm64" \\\n    --os="linux" \\\n    --offline-scan=true \\\n    --trivy-db-repo="REGISTRY_SERVER_URL/aquasecurity/trivy-db" \\\n    --trivy-java-db-repo="REGISTRY_SERVER_URL/aquasecurity/trivy-java-db" \\\n    --jobs=4\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"scan-in-trivy-client-mode",children:"Scan in trivy client mode"}),"\n",(0,i.jsxs)(n.p,{children:["Trivy provides a ",(0,i.jsx)(n.a,{href:"https://aquasecurity.github.io/trivy/v0.50/docs/references/modes/client-server/",children:"server-client mode"}),", Hangar can perform as a trivy client when scanning image."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Launch a ",(0,i.jsx)(n.a,{href:"https://aquasecurity.github.io/trivy/v0.50/docs/references/configuration/cli/trivy_server/",children:"trivy server"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"trivy server --listen 127.0.0.1:4954\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Use Hangar to scan images in trivy client mode."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'hangar scan \\\n    --file="example_image_list.txt" \\\n    --server="127.0.0.1:4954" \\\n    --arch="amd64,arm64" \\\n    --os="linux" \\\n    --jobs=4\n'})}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,a)=>{a.d(n,{Z:()=>c,a:()=>s});var i=a(7294);const r={},t=i.createContext(r);function s(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);