"use strict";(self.webpackChunkdocs_hangar=self.webpackChunkdocs_hangar||[]).push([[3020],{5026:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>g,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"sign/sign","title":"\u5bb9\u5668\u955c\u50cf\u52a0\u7b7e","description":"hangar sign \u547d\u4ee4\u4f7f\u7528 Sigstore \u79c1\u94a5\u4e3a\u5bb9\u5668\u955c\u50cf\u52a0\u7b7e\u3002","source":"@site/i18n/zh/docusaurus-plugin-content-docs/version-v1.9/14-sign/02-sign.md","sourceDirName":"14-sign","slug":"/sign/sign","permalink":"/zh/docs/v1.9/sign/sign","draft":false,"unlisted":false,"editUrl":"https://github.com/cnrancher/docs-hangar/edit/main/versioned_docs/version-v1.9/14-sign/02-sign.md","tags":[],"version":"v1.9","lastUpdatedAt":1739858970000,"sidebarPosition":2,"frontMatter":{"title":"\u5bb9\u5668\u955c\u50cf\u52a0\u7b7e"},"sidebar":"docs","previous":{"title":"\u751f\u6210 Sigstore \u5bc6\u94a5\u5bf9","permalink":"/zh/docs/v1.9/sign/generate-sigstore-key"},"next":{"title":"\u6821\u9a8c\u5df2\u52a0\u7b7e\u7684\u5bb9\u5668\u955c\u50cf","permalink":"/zh/docs/v1.9/sign/validate"}}');var a=i(4848),t=i(8453);const r={title:"\u5bb9\u5668\u955c\u50cf\u52a0\u7b7e"},c=void 0,o={},d=[{value:"\u5feb\u901f\u4e0a\u624b",id:"\u5feb\u901f\u4e0a\u624b",level:2},{value:"Usage",id:"usage",level:2}];function l(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"hangar sign"})," \u547d\u4ee4\u4f7f\u7528 Sigstore \u79c1\u94a5\u4e3a\u5bb9\u5668\u955c\u50cf\u52a0\u7b7e\u3002"]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["Hangar ",(0,a.jsx)(n.code,{children:"1.8"})," \u7684 ",(0,a.jsx)(n.code,{children:"sign"})," \u547d\u4ee4\u5728 ",(0,a.jsx)(n.code,{children:"1.9"})," \u4e2d\u5df2\u91cd\u547d\u540d\u4e3a ",(0,a.jsx)(n.code,{children:"signv1"})," \u5e76\u6807\u67f1\u4e3a\u5df2\u5f03\u7528\u3002\n\u82e5\u9700\u8981\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"1.8"})," \u5bf9\u5e94\u7684\u7b7e\u540d\u529f\u80fd\uff0c\u8bf7\u6267\u884c ",(0,a.jsx)(n.code,{children:"hangar signv1 --help"}),"\u3002"]})}),"\n",(0,a.jsx)(n.h2,{id:"\u5feb\u901f\u4e0a\u624b",children:"\u5feb\u901f\u4e0a\u624b"}),"\n",(0,a.jsx)(n.p,{children:"\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u4e3a\u5bb9\u5668\u955c\u50cf\u52a0\u7b7e\u3002"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"\u51c6\u5907\u4e00\u4efd\u6837\u4f8b\u955c\u50cf\u5217\u8868\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-txt",metastring:'title="example_image_list.txt"',children:"cnrancher/hangar:v1.9.0\ncnrancher/hangar:latest\n"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["\u5728\u52a0\u7b7e\u4e4b\u524d\uff0c\u60a8\u53ef\u4f7f\u7528 ",(0,a.jsx)(n.a,{href:"/docs/v1.9/mirror/mirror",children:"mirror"})," \u547d\u4ee4\u5c06\u5bb9\u5668\u955c\u50cf\u62f7\u8d1d\u81f3 ",(0,a.jsx)(n.em,{children:"\u79c1\u6709\u955c\u50cf\u4ed3\u5e93"})," \u4e2d\u3002"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"\u4f7f\u7528 Sigstore \u79c1\u94a5\u5bf9\u5bb9\u5668\u955c\u50cf\u52a0\u7b7e\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\nhangar sign \\\n    --file="example_image_list.txt" \\\n    --key="sigstore.key" \\\n    --arch amd64,arm64 \\\n    --os linux \\\n    --registry="REGISTRY_SERVER_URL" \\\n    --jobs=4\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["\u60a8\u53ef\u4ee5\u4f7f\u7528 ",(0,a.jsx)(n.a,{href:"/docs/v1.9/advanced/inspect/",children:"inspect"})," \u547d\u4ee4\u67e5\u770b\u5bb9\u5668\u955c\u50cf\u7684 Sigstore \u7b7e\u540d\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u9996\u5148\u67e5\u770b\u955c\u50cf\u7684 SHA256 Digest\uff0c\u672c\u4f8b\u4e3a ",(0,a.jsx)(n.code,{children:"sha256:25fd8fc1aefcc8ae46aae23daefcd7dcb97f676fa0bc72ba0cf7c1b75df4f22e"}),"\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\nhangar inspect --raw docker://REGISTRY_SERVER_URL/cnrancher/hangar:latest\n{\n  "schemaVersion": 2,\n  "mediaType": "application/vnd.docker.distribution.manifest.list.v2+json",\n  "manifests": [\n    {\n      "mediaType": "application/vnd.docker.distribution.manifest.v2+json",\n      "size": 528,\n      "digest": "sha256:25fd8fc1aefcc8ae46aae23daefcd7dcb97f676fa0bc72ba0cf7c1b75df4f22e",\n      "platform": {\n        "architecture": "amd64",\n        "os": "linux"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u6839\u636e Sigstore \u955c\u50cf\u7b7e\u540d TAG\uff0c\u67e5\u770b Sigstore \u7b7e\u540d Manifest\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\nhangar inspect --raw "docker://REGISTRY_SERVER_URL/cnrancher/hangar:sha256-25fd8fc1aefcc8ae46aae23daefcd7dcb97f676fa0bc72ba0cf7c1b75df4f22e.sig"  | jq\n{\n  "schemaVersion": 2,\n  "mediaType": "application/vnd.oci.image.manifest.v1+json",\n  "config": {\n    "mediaType": "application/vnd.oci.image.config.v1+json",\n    "digest": "sha256:7abad20a44f07298df4f74a474baae8873f2009377cee2b468cf1dbad8275a31",\n    "size": 227\n  },\n  "layers": [\n    {\n      "mediaType": "application/vnd.dev.cosign.simplesigning.v1+json",\n      "digest": "sha256:af8fb401acf93b9ae2ef0be057d7e1ce9aa1044ef6744877aa16d693dc170c7e",\n      "size": 373,\n      "annotations": {\n        "dev.cosignproject.cosign/signature": "MEYCIQCZvL..."\n      }\n    },\n    {\n      "mediaType": "application/vnd.dev.cosign.simplesigning.v1+json",\n      "digest": "sha256:6f67c286b98255ee81ebf27af90bf8f1d980759fd8a64c7750cbb3d7d682c1d4",\n      "size": 373,\n      "annotations": {\n        "dev.cosignproject.cosign/signature": "MEUCIQ......"\n      }\n    }\n  ]\n}\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"\u6821\u9a8c\u5df2\u52a0\u7b7e\u7684\u955c\u50cf\u3002"}),"\n",(0,a.jsxs)(n.p,{children:["\u53ef\u4f7f\u7528 ",(0,a.jsx)(n.a,{href:"/docs/v1.9/sign/validate",children:"sign validate"})," \u547d\u4ee4\u5bf9\u5df2\u52a0\u7b7e\u7684\u5bb9\u5668\u955c\u50cf\u8fdb\u884c\u6821\u9a8c\u3002"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-txt",metastring:'title="hangar sign --help"',children:'Sign images with cosign sigstore private key\n\nUsage:\n  hangar sign [flags]\n  hangar sign [command]\n\nExamples:\nhangar sign --key cosign.key <IMAGE>\n\nAvailable Commands:\n  validate    Validate the signed images with cosign sigstore public key\n\nFlags:\n  -a, --arch strings             architecture list of images (default [amd64,arm64])\n  -y, --auto-yes                 answer yes automatically (used in shell script)\n  -o, --failed string            file name of the scan failed image list (default "sign-failed.txt")\n  -f, --file string              image list file\n      --fulcio-url string        address of sigstore PKI server (default "https://fulcio.sigstore.dev")\n  -h, --help                     help for sign\n  -j, --jobs int                 worker number, scan images parallelly (1-20) (default 1)\n  -p, --key string               path to the private key file, KMS URI or Kubernetes Secret\n      --oidc-client-id string    OIDC client ID for application (default "sigstore")\n      --oidc-issuer string       OIDC provider to be used to issue ID token (default "https://oauth2.sigstore.dev/auth")\n      --oidc-provider string     Specify the provider to get the OIDC token from (Optional) (available: spiffe, google, github-actions, filesystem, buildkite-agent)\n      --os strings               OS list of images (default [linux])\n      --passphrase-file string   private key passphrase file\n      --project string           override all image projects in image list\n      --registry string          override all image registry URL in image list\n      --rekor-url string         address of rekor STL server (default "https://rekor.sigstore.dev")\n      --skip-login               skip check the registry is logged in (used in shell script)\n      --timeout duration         timeout when scan each images (default 10m0s)\n      --tlog-upload              whether or not to upload to the cosign transparency log server (default true)\n      --tls-verify               require HTTPS and verify certificates\n\nGlobal Flags:\n      --debug             enable debug output\n      --insecure-policy   run Hangar without policy check\n\nUse "hangar sign [command] --help" for more information about a command.\n'})})]})}function g(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var s=i(6540);const a={},t=s.createContext(a);function r(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);